<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.11"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>BAT manual: Getting started</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
    TeX: {
        Macros: {
            cond: ["{\\,|\\,}"],
            rmdx: ["{\\mbox{d}#1\\,}",1],
            scath: ["{\\theta}"],
            vecth: ["{\\boldsymbol{\\theta}}"],
            order: ["{\\mathcal{O}(#1)}",1],
        }
    }
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">BAT manual 1.0.0-RC2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li class="current"><a href="pages.html"><span>Chapters</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Getting started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sec-basics-define-a-model">Defining a model</a><ul><li class="level2"><a href="#subsec-basics-add-parameters">Adding parameters</a></li>
<li class="level2"><a href="#subsec-basics-setting-priors">Setting prior distributions</a></li>
<li class="level2"><a href="#subsec-basics-loglikelihood">Defining a likelihood</a></li>
</ul>
</li>
<li class="level1"><a href="#sec-basics-output">Looking at the output</a></li>
<li class="level1"><a href="#sec-basics-observables">Adding an observable</a></li>
<li class="level1"><a href="#sec-basics-other-output">Further Output</a></li>
</ul>
</div>
<div class="textblock"><p>To demonstrate the basic usage of BAT, we will build an example analysis step by step. Step one, naturally, is to install BAT&mdash;please refer to the installation chapter in this <a class="el" href="INSTALL_8md_source.html">manual</a> or <a href="https://github.com/bat/bat/blob/master/INSTALL.md">online</a>. To check if you have BAT installed and accessible, run the following command </p><pre class="fragment">bat-config
</pre><p>in your terminal. It should output a usage statement. This program outputs information about your BAT installation: </p><table class="doxtable">
<tr>
<th><code>bat-config</code> Flag </th><th>Returned Information </th></tr>
<tr>
<td><code>--prefix</code> </td><td>Path to BAT installation </td></tr>
<tr>
<td><code>--version</code> </td><td>BAT version identifier </td></tr>
<tr>
<td><code>--libs</code> </td><td>Linker flags for compiling code using BAT </td></tr>
<tr>
<td><code>--cflags</code> </td><td>C++ compiler flags for compiling code using BAT </td></tr>
<tr>
<td><code>--bindir</code> </td><td>Path to BAT binaries directory </td></tr>
<tr>
<td><code>--incdir</code> </td><td>Path to BAT include directory </td></tr>
<tr>
<td><code>--libdir</code> </td><td>Path to BAT libraries directory </td></tr>
</table>
<p>BAT has a second executable, which creates for you the files necessary to start a basic analysis. We will use this executable to initialize our tutorial project: </p><pre class="fragment">bat-project MyTut MyMod
</pre><p>This will create a directory called <code>MyTut</code> that contains </p><table class="doxtable">
<tr>
<td><code>Makefile</code> </td><td>a makefile to compile our tutorial project </td></tr>
<tr>
<td><code>runMyTut.cxx</code> </td><td>the C++ source to an executable to run our tutorial project </td></tr>
<tr>
<td><code>MyMod.h</code> </td><td>the C++ header for our tutorial model <code>MyMod</code> </td></tr>
<tr>
<td><code>MyMod.cxx</code> </td><td>the C++ source for our tutorial model <code>MyMod</code> </td></tr>
</table>
<p>If BAT is installed correctly, you can compile and run this project already: </p><pre class="fragment">cd MyTut
make
./runMyTut
</pre><p>BAT will issue a series of errors telling you your model has no parameters. Because of course we haven't actually put anything into our model yet. Let's do that.</p>
<h1><a class="anchor" id="sec-basics-define-a-model"></a>
Defining a model</h1>
<p>To define a valid BAT model we must make three additions to the empty model that <code>bat-project</code> has created:</p><ol type="1">
<li>we must add parameters to our model;</li>
<li>we must implement a log-likelihood function;</li>
<li>and we must implement or state our priors.</li>
</ol>
<p>We will start with a simple model that fits a normal distribution to data, and so has three parameters: the mode ( \(\mu\)) and standard deviation ( \(\sigma\)) of our distribution, and a scaling factor ("height"). We will start with flat priors for all.</p>
<p>How you store and access your data is entirely up to you. For this example, we are going to fit to a binned data set that we store as a ROOT histogram in a private member of our model class. In the header, add to the class</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;TH1D.h&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">class MyMod : <span class="keyword">public</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCModel.html">BCModel</a></div><div class="line">{</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">private:</div><div class="line">    TH1D fDataHistogram</div><div class="line"></div><div class="line">};</div></div><!-- fragment --><p>And in the source file, we initialize our <code>fDataHistogram</code> in the constructor; let's also fill it with some random data, which ROOT can do for us using a TF1:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;MyMod.h&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;TF1.h&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">// ---------------------------------------------------------</span></div><div class="line">MyMod::MyMod(<span class="keyword">const</span> std::string&amp; name)</div><div class="line">    : <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCModel.html">BCModel</a>(name),</div><div class="line">      fDataHistogram(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;;mass [GeV];count&quot;</span>, 100, 5.0, 5.6)</div><div class="line">{</div><div class="line">    <span class="comment">// create function to fill data according to</span></div><div class="line">    TF1 data_func(<span class="stringliteral">&quot;data_func&quot;</span>, <span class="stringliteral">&quot;exp(-0.5*((x - 5.27926) / 0.04)^2)&quot;</span>, 5.0, 5.6);</div><div class="line"></div><div class="line">    <span class="comment">// fill data histogram randomly from data_func 1,000 times</span></div><div class="line">    fDataHistogram.FillRandom(<span class="stringliteral">&quot;data_func&quot;</span>, 1e3);</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="subsec-basics-add-parameters"></a>
Adding parameters</h2>
<p>To add a parameter to a model, call its member function <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCEngineMCMC.html#a2e33a6b426092126b408c69c4a9bce22">BCModel::AddParameter</a></code>: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> AddParameter(<span class="keyword">const</span> std::string&amp; name, <span class="keywordtype">double</span> min, <span class="keywordtype">double</span> max, <span class="keyword">const</span> std::string&amp; latexname = <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">const</span> std::string&amp; unitstring = <span class="stringliteral">&quot;&quot;</span>)</div></div><!-- fragment --><p>You must indicate a parameter's name and its allowed range, via <code>min</code> and <code>max</code>. Each parameter must be added with a unique name. BAT will also create a "safe version" of the name which removes all non alpha-numeric characters except for the underscore, which is needed for naming of internal storage objects. Each parameter name should also convert to a unique safe name; BAT will complain if this is not the case (and <code>AddParameter</code> will return <code>false</code>).</p>
<p>Optionally, you may add a display name for the parameter and a unit string, both of which are used when BAT creates plots.</p>
<p>The most logical place to add parameters to a model is in its constructor. Let us now edit <code>MyMod.cxx</code> to add our mode, standard deviation, and height parameters inside the constructor:</p>
<div class="fragment"><div class="line">MyMod::MyMod(<span class="keyword">const</span> std::string&amp; name)</div><div class="line">    : <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCModel.html">BCModel</a>(name),</div><div class="line">      fDataHistogram(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;;mass [GeV];count&quot;</span>, 100, 5.0, 5.6)</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    AddParameter(<span class="stringliteral">&quot;mu&quot;</span>,    5.27, 5.29, <span class="stringliteral">&quot;#mu&quot;</span>, <span class="stringliteral">&quot;[GeV]&quot;</span>);</div><div class="line">    AddParameter(<span class="stringliteral">&quot;sigma&quot;</span>, 25e-3, 45e-3, <span class="stringliteral">&quot;#sigma&quot;</span>, <span class="stringliteral">&quot;[GeV]&quot;</span>);</div><div class="line">    AddParameter(<span class="stringliteral">&quot;height&quot;</span>, 0, 10, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;[events]&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p>I have chosen the ranges because I have prior information about the data: the mode of my distribution will be between 5.27 and 5.29; the standard deviation will be between 0.025 and 0.045; and the height will be between 0 and 10. When we provide a prior for a parameter, \(p_0(\lambda)\), the prior BAT uses is</p>
<p class="formulaDsp">
\begin{equation} P_0(\lambda) = \begin{cases} p_0(\lambda),&amp; \text{if } \lambda\in[\lambda_{\text{min}}, \lambda_{\text{max}}],\\ 0,&amp; \text{otherwise.} \end{cases} \end{equation}
</p>
<p>So keep mind that the ranges your provide for parameters become part of the prior: BAT will not explore parameter space outside of the range limits you provide.</p>
<p>If you have written the code correctly for adding parameters to your model, your code should compile. BAT will again, though, issue an error if you try to run <code>runMyTut</code>, since we are still missing priors.</p>
<h2><a class="anchor" id="subsec-basics-setting-priors"></a>
Setting prior distributions</h2>
<p>There are two ways we may set the prior, \(P_0(\vec\lambda)\) for a parameter point: We can override the function that returns the log <em>a priori</em> probability for a model (<code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCModel.html#a1b4a771c494814552084705771be53eb">BCModel::LogAPrioriProbability</a></code>) and code anything we can dream of in C++:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> MyMod::LogAPrioriProbability(<span class="keyword">const</span> std::vector&lt;double&gt;&amp; pars)</div><div class="line">{</div><div class="line">   ...</div><div class="line">}</div></div><!-- fragment --><p>In this case, you have to make sure the prior is properly normalized if you wish to compare different models as BAT will not do this for you.</p>
<p>Or we can set individual priors for each parameter, and BAT will multiply them together for us including the proper normalization. If each parameter has a prior that factorizes from all the others, then this is the much better option. In this case, we <b>must not</b> override <code>LogAPrioriProbability</code>. Instead we tell BAT what the factorized prior is for each parameter, by adding a <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a></code> object to each parameter after we create it:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;BAT/BCGaussianPrior.h&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">MyMod::MyMod(<span class="keyword">const</span> std::string&amp; name)</div><div class="line">    : <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCModel.html">BCModel</a>(name),</div><div class="line">      fDataHistogram(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;;mass [GeV];count&quot;</span>, 100, 5.0, 5.6)</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// add parameters for Gaussian distribution</span></div><div class="line">    AddParameter(<span class="stringliteral">&quot;mu&quot;</span>,    5.27, 5.29, <span class="stringliteral">&quot;#mu&quot;</span>, <span class="stringliteral">&quot;[GeV]&quot;</span>);</div><div class="line">    GetParameters().Back().SetPrior(<span class="keyword">new</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html">BCGaussianPrior</a>(5.28, 2e-3));</div><div class="line"></div><div class="line">    AddParameter(<span class="stringliteral">&quot;sigma&quot;</span>, 25e-3, 45e-3, <span class="stringliteral">&quot;#sigma&quot;</span>, <span class="stringliteral">&quot;[GeV]&quot;</span>);</div><div class="line">    GetParameters().Back().SetPrior(<span class="keyword">new</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html">BCGaussianPrior</a>(35e-3, 3e-3));</div><div class="line"></div><div class="line">    AddParameter(<span class="stringliteral">&quot;height&quot;</span>, 0, 10, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;[events]&quot;</span>);</div><div class="line">    GetParameters().Back().SetPriorConstant();</div><div class="line">}</div></div><!-- fragment --><p>We could create a <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCConstantPrior.html">BCConstantPrior</a></code> object for <code>height</code> just as we created a <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html">BCGaussianPrior</a></code> object for <code>mu</code> and <code>sigma</code>, but BAT has a convenient function that creates one for us.</p>
<p>We can now compile our code and run it. The results will be meaningless, though, since we have yet to define our likelihood.</p>
<h2><a class="anchor" id="subsec-basics-loglikelihood"></a>
Defining a likelihood</h2>
<p>The heart of our model is the likelihood function&mdash;more specifically, since BAT works with the natural logarithm of functions, our log-likelihood function.</p>
<p>Given a histogrammed data set containing numbers of events in each bin, our statistical model is the product of Poisson probabilities for each bin&mdash;the probability of the events observed in the bin given the expectation from our model function:</p>
<p class="formulaDsp">
\begin{equation} \mathcal{L}(\vec\lambda) \equiv \prod_{i} \text{Poisson}(n_i|\nu_i), \end{equation}
</p>
<p>where \(n_i\) is the number of events in bin \(i\) and \(\nu_i\) is the expected number of events given our model, which we will take as the value of our model function at the center of the bin, \(m_i\),</p>
<p class="formulaDsp">
\begin{equation} \nu_i \equiv f(m_i) = \frac{1}{\sqrt{2\pi}\sigma}\exp{\left(-\frac{(m_i - \mu)^2}{2\sigma^2}\right)}. \end{equation}
</p>
<p>Working with the log-likelihood, this transforms into a sum:</p>
<p class="formulaDsp">
\begin{equation} \log\mathcal{L}(\vec\lambda) \equiv \sum_{i} \log\text{Poisson}(n_i|\nu_i). \end{equation}
</p>
<p>BAT conveniently has a function to calculate the logarithm of the Poisson distribution (with observed \(x\) and expected \(\lambda\)) for you:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/namespaceBCMath.html#a11de749036a67e40b8620447d1aa75fe">BCMath::LogPoisson</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> lambda)</div></div><!-- fragment --><p>Let us code this into our log-likelihood function:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;BAT/BCMath.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;TMath.h&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">// ---------------------------------------------------------</span></div><div class="line">double MyMod::LogLikelihood(<span class="keyword">const</span> std::vector&lt;double&gt;&amp; pars)</div><div class="line">{</div><div class="line">    <span class="comment">// store our log-likelihood as we loop through bins</span></div><div class="line">    <span class="keywordtype">double</span> LL = 0.;</div><div class="line"></div><div class="line">    <span class="comment">// loop over bins of our data</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= fDataHistogram.GetNbinsX(); ++i) {</div><div class="line"></div><div class="line">        <span class="comment">// retrieve observed number of events</span></div><div class="line">        <span class="keywordtype">double</span> x = fDataHistogram.GetBinContent(i);</div><div class="line"></div><div class="line">        <span class="comment">// retrieve bin center</span></div><div class="line">        <span class="keywordtype">double</span> m = fDataHistogram.GetBinCenter(i);</div><div class="line"></div><div class="line">        <span class="comment">// calculate expected number of events, using ROOT Gaus function</span></div><div class="line">        <span class="keywordtype">double</span> nu = TMath::Gaus(m, pars[0], pars[1], <span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// add to log-likelihood sum</span></div><div class="line">        LL += <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/namespaceBCMath.html#a11de749036a67e40b8620447d1aa75fe">BCMath::LogPoisson</a>(x, nu);</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// return log-likelihood</span></div><div class="line">    <span class="keywordflow">return</span> LL;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="sec-basics-output"></a>
Looking at the output</h1>
<p>Our model class is now ready to go. Let's just make one edit to the <code>runMyTut.cxx</code> file to change our model name from the default "name_me" to something sensible:</p>
<div class="fragment"><div class="line"><span class="comment">// create new MyMod object</span></div><div class="line">MyMod m(<span class="stringliteral">&quot;gaus_mod&quot;</span>);</div></div><!-- fragment --><p>We can now compile and run our project: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;./runMyTut</div></div><!-- fragment --><p>This will sample from the posterior probability distribution and marginalize the results, saving plots to <code>gaus_mod_plots.pdf</code>. In that file you should see the 1D and 2D marginalizations of our three parameters:</p>
<div class="image">
<img src="gaus_mod_plots-1.png" alt="gaus_mod_plots-1.png"/>
<div class="caption">
1D Posteriors of Gaussian distribution model.</div></div>
<p>\ <div class="image">
<img src="gaus_mod_plots-2.png" alt="gaus_mod_plots-2.png"/>
<div class="caption">
2D Posteriors of Gaussian distribution model.</div></div>
<p>\ <p>In each plot, we see the global mode and the marginalized mean and standard deviation of the posterior distribution; and three credibility intervals.</p>
<p>BAT has also printed a summary of the results to the log file and command line. This includes the global mode </p><pre class="fragment">Summary :  Global mode:
Summary :  0)  Parameter "mu"          : 5.279741 +- 0.001072076
Summary :  1)  Parameter "sigma"       : 0.040267 +- 0.00089553
Summary :  2)  Parameter "height"      : 6 +- 0.1897
</pre><p>and marginalized posteriors: </p><pre class="fragment">Summary :   (0) Parameter "mu" :
Summary :       Mean +- sqrt(Variance):         5.279748 +- 0.001065279
Summary :       Median +- central 68% interval: 5.279749 +  0.00105881 - -0.00106418
Summary :       (Marginalized) mode:            5.2797
Summary :        5% quantile:                   5.278005
Summary :       10% quantile:                   5.278381
Summary :       16% quantile:                   5.278685
Summary :       84% quantile:                   5.280808
Summary :       90% quantile:                   5.281112
Summary :       95% quantile:                   5.281498
Summary :       Smallest interval containing 69.8% and local mode:
Summary :       (5.2786, 5.2808) (local mode at 5.2797 with rel. height 1; rel. area 1)
</pre><h1><a class="anchor" id="sec-basics-observables"></a>
Adding an observable</h1>
<p>We can store the posterior distribution of any function of the parameters of our model using BAT's <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCObservable.html">BCObservable</a></code>'s. Let us suppose we want to know the posterior distribution for the total number of events our model predicts&mdash;the signal yield; and we want to know the standard deviation's relation to the mean: \(\sigma/\mu\). In our constructor, we add the observables in the same way we added our parameters:</p>
<div class="fragment"><div class="line"><span class="comment">// ---------------------------------------------------------</span></div><div class="line">MyMod::MyMod(<span class="keyword">const</span> std::string&amp; name)</div><div class="line">    : <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCModel.html">BCModel</a>(name),</div><div class="line">      fDataHistogram(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;mass [GeV];count&quot;</span>, 100, 5.0, 5.6)</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    AddObservable(<span class="stringliteral">&quot;SignalYield&quot;</span>, 900, 1100, <span class="stringliteral">&quot;Y_{S}&quot;</span>, <span class="stringliteral">&quot;[events]&quot;</span>);</div><div class="line">    AddObservable(<span class="stringliteral">&quot;Resolution&quot;</span>,</div><div class="line">                  100. * GetParameter(<span class="stringliteral">&quot;sigma&quot;</span>).GetLowerLimit() / GetParameter(<span class="stringliteral">&quot;mu&quot;</span>).GetUpperLimit(),</div><div class="line">                  100. * GetParameter(<span class="stringliteral">&quot;sigma&quot;</span>).GetUpperLimit() / GetParameter(<span class="stringliteral">&quot;mu&quot;</span>).GetLowerLimit(),</div><div class="line">                  <span class="stringliteral">&quot;#sigma / #mu&quot;</span>, <span class="stringliteral">&quot;[%]&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p>Note that an observable does not need a prior since it is not a parameter; but it does need a range for setting the marginalized histogram's limits. Since we know already that the answer will be 1000 events with an uncertainty of \(\sqrt{1000}\), we set the range for the yield to \([900, 1100]\).</p>
<p>And we need to calculate this observable in our <code>CalculateObservables(...)</code> member function. Uncomment it in the header file <code>MyMod.h</code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> CalculateObservables(<span class="keyword">const</span> std::vector&lt;double&gt; &amp; pars);</div></div><!-- fragment --><p>and implement it in the source: </p><div class="fragment"><div class="line"><span class="comment">// ---------------------------------------------------------</span></div><div class="line"><span class="keywordtype">void</span> MyMod::CalculateObservables(<span class="keyword">const</span> std::vector&lt;double&gt;&amp; pars)</div><div class="line">{</div><div class="line">    <span class="comment">// store total of number events expected</span></div><div class="line">    <span class="keywordtype">double</span> nu = 0;</div><div class="line"></div><div class="line">    <span class="comment">// loop over bins of our data</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= fDataHistogram.GetNbinsX(); ++i)</div><div class="line">        <span class="comment">// calculate expected number of events in that bin</span></div><div class="line">        <span class="comment">// and add to total expectation</span></div><div class="line">        nu += pars[2] * TMath::Gaus(fDataHistogram.GetBinCenter(i), pars[0], pars[1], <span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// store in the observable</span></div><div class="line">    GetObservable(0) = nu;</div><div class="line"></div><div class="line">    <span class="comment">// Store sigma as percentage of mu:</span></div><div class="line">    GetObservable(1) = 100. * pars[1] / pars[0];</div><div class="line">}</div></div><!-- fragment --><p>Compile and run <code>runMyTut.cxx</code> and you will see new marginalized distributions and text output for the observables: </p><pre class="fragment">Summary :   (3) Observable "SignalYield" :
Summary :       Mean +- sqrt(Variance):         1000.9 +- 31.53
Summary :       Median +- central 68% interval: 1000.6 +  31.937 - -31.194
Summary :       (Marginalized) mode:            1003
Summary :        5% quantile:                   949.52
Summary :       10% quantile:                   960.52
Summary :       16% quantile:                   969.44
Summary :       84% quantile:                   1032.6
Summary :       90% quantile:                   1041.9
Summary :       95% quantile:                   1053.5
Summary :       Smallest intervals containing 68.7% and local modes:
Summary :       (970, 1032) (local mode at 1003 with rel. height 1; rel. area 0.97769)
Summary :       (1032, 1034) (local mode at 1033 with rel. height 0.57407; rel. area 0.022311)
</pre><p>As we expected, the mean of the total yield posterior is just the number of events in our data set and the standard deviation is its square root.</p>
<h1><a class="anchor" id="sec-basics-other-output"></a>
Further Output</h1>
<p>BAT has a few more output options than the two mentioned above. The code for turning them on is already included in the <code>runMyTut.cxx</code> generated by <code>bat-project</code>. You can write the Markov-chain samples to a ROOT <code>TTree</code> for further postprocessing by uncommenting the following line:</p>
<div class="fragment"><div class="line">m.WriteMarkovChain(m.GetSafeName() + <span class="stringliteral">&quot;_mcmc.root&quot;</span>, <span class="stringliteral">&quot;RECREATE&quot;</span>);</div></div><!-- fragment --><p>You can also modify the plotting output to include more plots per page. Without specifying, we used the default of one plot per page. Let's instead plot 4 plots (in a 2-by-2 grid):</p>
<div class="fragment"><div class="line">m.PrintAllMarginalized(m.GetSafeName() + <span class="stringliteral">&quot;_plots.pdf&quot;</span>, 2, 2);</div></div><!-- fragment --><p>There are four more graphical outputs from BAT. Turn them on by uncommenting the following lines </p><div class="fragment"><div class="line">m.PrintParameterPlot(m.GetSafeName() + <span class="stringliteral">&quot;_parameters.pdf&quot;</span>);</div><div class="line">m.PrintCorrelationPlot(m.GetSafeName() + <span class="stringliteral">&quot;_correlation.pdf&quot;</span>);</div><div class="line">m.PrintCorrelationMatrix(m.GetSafeName() + <span class="stringliteral">&quot;_correlationMatrix.pdf&quot;</span>);</div><div class="line">m.PrintKnowledgeUpdatePlots(m.GetSafeName() + <span class="stringliteral">&quot;_update.pdf&quot;</span>, 3, 2);</div></div><!-- fragment --><p> (We have edited the last line to specify 3-by-2 printing.)</p>
<p>The parameter plot graphically summarizes the output for all parameters (and in a separate page, all observables) in a single image:</p>
<div class="image">
<img src="gaus_mod_parameters-1.png" alt="gaus_mod_parameters-1.png"/>
<div class="caption">
Summary of parameter marginalizations.</div></div>
<p>The correlation plot and the correlation matrix summarize graphically the correlations among parameters and observables:</p>
<div class="image">
<img src="gaus_mod_correlation.png" alt="gaus_mod_correlation.png"/>
<div class="caption">
Parameter and observable correlation plots.</div></div>
<div class="image">
<img src="gaus_mod_correlationMatrix.png" alt="gaus_mod_correlationMatrix.png"/>
<div class="caption">
Parameter and observable correlation matrix.</div></div>
<p>The knowledge update plots show the marginalized priors and marginalized posteriors together in one plot for each variable (and also for 2D marginalizations):</p>
<div class="image">
<img src="gaus_mod_update-1.png" alt="gaus_mod_update-1.png"/>
<div class="caption">
Knowledge update plots.</div></div>
<p>Note that this really shows the <em>marginalized</em> prior: Here, having used factorized priors, we see exactly the factorized priors. But had we used a multivariate prior, then we'd see what this looks like for each parameter. We also see what the prior of our observables look like given the priors of the variables they are functions of. These are very useful things to know. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<!-- <hr class="footer"/><address class="footer"><small> -->
<!-- Generated on Tue May 8 2018 13:18:41 for BAT manual by &#160;<a href="http://www.doxygen.org/index.html"> -->
<!-- <img class="footer" src="doxygen.png" alt="doxygen"/> -->
<!-- </a> 1.8.11 -->
<!-- </small></address> -->
</body>
</html>
