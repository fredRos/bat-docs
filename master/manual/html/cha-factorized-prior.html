<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.11"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>BAT manual: Defining a factorized prior</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
MathJax.Hub.Config({
    TeX: {
        Macros: {
            cond: ["{\\,|\\,}"],
            rmdx: ["{\\mbox{d}#1\\,}",1],
            scath: ["{\\theta}"],
            vecth: ["{\\boldsymbol{\\theta}}"],
            order: ["{\\mathcal{O}(#1)}",1],
        }
    }
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">BAT manual 1.0.0-RC2</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li class="current"><a href="pages.html"><span>Chapters</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Defining a factorized prior </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>If a model does not overload <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCModel.html#a1b4a771c494814552084705771be53eb">BCModel::LogAPrioriProbability</a></code>, then its prior is the product of the individual priors for each of its parameters. We call these the factorized priors. To set a parameter's prior call </p><div class="fragment"><div class="line"><a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCParameter.html#a6a4e886fd620dd6dcf4f82c6017dd11b">BCParameter::SetPrior</a>(<a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a>* <span class="keyword">const</span> prior);</div></div><!-- fragment --><p> You can call factorized priors within your overloaded <code>LogAPrioriProbability</code> by querying the log of the prior of a particular parameter with </p><div class="fragment"><div class="line"><a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCParameter.html#aed53ea73bd2aea767956389467dfca09">BCParameter::GetLogPrior</a>(<span class="keywordtype">double</span> x)</div></div><!-- fragment --><p> The prior you set for a parameter need only inherit from <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a></code>. BAT has several built in prior classes, such as <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCConstantPrior.html">BCConstantPrior</a></code> and <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html">BCGaussianPrior</a></code>. You can implement new factorized priors by inheriting from the <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a></code> class. To illustrate how to do this, we will work through the construction of the Gaussian prior: </p><div class="fragment"><div class="line"><span class="keyword">class </span><a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html">BCGaussianPrior</a> : <span class="keyword">public</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a></div></div><!-- fragment --><p> <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a></code> is a pure-virtual class with three methods that must be overloaded: </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a7e89328f3d6e10c9903404ddab95ac79">GetLogPrior</a>(<span class="keywordtype">double</span> x);</div><div class="line"><a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a>* clone() <span class="keyword">const</span>;</div><div class="line"><span class="keywordtype">bool</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a9ae9e99ff316d45407c30aa6b9d5d1c9">IsValid</a>() <span class="keyword">const</span>;</div></div><!-- fragment --><p> The first one contains the meat of our new prior: </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a7e89328f3d6e10c9903404ddab95ac79">GetLogPrior</a>(<span class="keywordtype">double</span> x)</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> -0.5 * (x - <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a3247201e209936f022f62f6a0eea78bf">fMean</a>) * (x - <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a3247201e209936f022f62f6a0eea78bf">fMean</a>) / <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a35aea94860561f4aab66859a9171010b">fSigma</a> / <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a35aea94860561f4aab66859a9171010b">fSigma</a> - log(<a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a35aea94860561f4aab66859a9171010b">fSigma</a>) - 0.5 * log(2 * M_PI);</div><div class="line">}</div></div><!-- fragment --><p> This is, naturally, the log of a Guassian prior. The second one should simply return a copy of the prior: </p><div class="fragment"><div class="line"><a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a>* clone()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#aaf2306d2eabe4deedd98562bb612e3fe">BCGaussianPrior</a>(*<span class="keyword">this</span>);</div><div class="line">}</div></div><!-- fragment --><p> The last function is required for checking that everything that is needed by the prior is properly set. You'll notice that our example calls on two member variables in its <code>GetLogPrior</code>: <code>fMean</code> and <code>fSigma</code>. So we must check whether they have been properly set: </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a9ae9e99ff316d45407c30aa6b9d5d1c9">IsValid</a>()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">  <span class="keywordflow">return</span> std::isfinite(<a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a3247201e209936f022f62f6a0eea78bf">fMean</a>) and std::isfinite(<a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a35aea94860561f4aab66859a9171010b">fSigma</a>) and <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a35aea94860561f4aab66859a9171010b">fSigma</a> &gt; 0;</div><div class="line">}</div></div><!-- fragment --><p> This checks that the mean and standard deviation are both finite and that the standard deviation is positive semi-definite, as it need be.</p>
<p>Naturally to be of use, we also create a constructor that allows us to set the mean and standard deviation at creation; and getters and setters that allow us to access them. (See the source code of <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html">BCGaussianPrior</a></code> for their implementation.)</p>
<p>This is all that is required to create a new prior. <code><a class="elRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCPrior.html">BCPrior</a></code> has several methods for getting properties of the prior: the mode; the integral over a range; the \(n\)'th raw, central, and standardized moments; the mean; the variance; the standard deviation; the skewness; and the kurtosis. These functions make their own internal calculations and need not be overloaded. If you wish to speed them up, or provide exact results, you may overload them. But take care that you overload them to give back proper results! For example, the mode of the Gaussian distribution is not simply <code>fMean</code>, since this presumes the range over which we query contains <code>fMean</code>. The more proper implementation is </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#aa5697c997e5475be6dc96a2e11b273e2">GetMode</a>(<span class="keywordtype">double</span> xmin, <span class="keywordtype">double</span> xmax)</div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (<a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a3247201e209936f022f62f6a0eea78bf">fMean</a> &lt; xmin)</div><div class="line">    <span class="keywordflow">return</span> xmin;</div><div class="line">  <span class="keywordflow">if</span> (<a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a3247201e209936f022f62f6a0eea78bf">fMean</a> &gt; xmax)</div><div class="line">    <span class="keywordflow">return</span> xmax;</div><div class="line">  <span class="keywordflow">return</span> <a class="codeRef" doxygen="/root/bat/doc/ref-guide/bat-ref.tag:../../ref-guide/html/" href="../../ref-guide/html/classBCGaussianPrior.html#a3247201e209936f022f62f6a0eea78bf">fMean</a>;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<!-- <hr class="footer"/><address class="footer"><small> -->
<!-- Generated on Tue May 8 2018 13:18:41 for BAT manual by &#160;<a href="http://www.doxygen.org/index.html"> -->
<!-- <img class="footer" src="doxygen.png" alt="doxygen"/> -->
<!-- </a> 1.8.11 -->
<!-- </small></address> -->
</body>
</html>
